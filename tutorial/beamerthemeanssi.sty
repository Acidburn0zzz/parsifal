% Copyright 2011 ANSSI
%
\usepackage{multirow,multicol,rotating,float,color,epsfig,placeins}
\usepackage{fancybox}
\usepackage{chngpage}
\usepackage{lipsum}
\usepackage[savepos]{zref}
\usepackage[absolute, overlay]{textpos}
\usepackage{calc}


%\RequirePackage{beamerarticle}
%\RequirePackage{beamerbasearticle}
%\RequirePackage{beamerbaseauxtemplates}
%\RequirePackage{beamerbaseboxes}
%\RequirePackage{beamerbasecolor}
%\RequirePackage{beamerbasecompatibility}
%\RequirePackage{beamerbasedecode}
%\RequirePackage{beamerbaseexercise}
%\RequirePackage{beamerbasefont}
%\RequirePackage{beamerbaseframecomponents}
%\RequirePackage{beamerbaseframesize}
%\RequirePackage{beamerbaseframe}
%\RequirePackage{beamerbaselocalstructure}
%\RequirePackage{beamerbasemisc}
%\RequirePackage{beamerbasemodes}
%\RequirePackage{beamerbasenavigation}
%\RequirePackage{beamerbasenotes}
%\RequirePackage{beamerbaseoptions}
%\RequirePackage{beamerbaseoverlay}
%\RequirePackage{beamerbasercs}
%\RequirePackage{beamerbasesection}
%\RequirePackage{beamerbasetemplates}
%\RequirePackage{beamerbasethemes}
%\RequirePackage{beamerbasetheorems}
%\RequirePackage{beamerbasetitle}
%\RequirePackage{beamerbasetoc}
%\RequirePackage{beamerbasetwoscreens}
%\RequirePackage{beamerbaseverbatim}


\mode<presentation>
\definecolor{anssibleu}{rgb}{0.03,0.29,0.55}
\definecolor{vert}{rgb}{0,1,0}
\definecolor{vertl}{rgb}{0,0.5,0}
\definecolor{gris}{rgb}{0.26,0.29,0.32}
\definecolor{grisl}{rgb}{0.9,0.9,0.9}
\definecolor{grisl2}{rgb}{0.95,0.95,0.95}
\definecolor{grisl3}{rgb}{0.7,0.7,0.7}
\definecolor{rougel}{rgb}{0.8,0,0}
\definecolor{rouge}{rgb}{1,0,0}

\def\@mydate{}
\def\@mylang{en}
\def\@mynavigation{zero}
\def\@mysubnavigation{zero}
\def\@mypagenumbering{yes}
\def\@mynavigationtype{}
\def\@myconfidentiality{}
\def\@mydiffcountries{}
\def\@globalconfidentiality{}
\def\@globalbackgroundimage{}

% Title left margin
\def\@titleleftmargin{1cm}
% Body text left margin
\def\@bodyleftmargin{0.4cm}

\newenvironment{changemargin}[2]{%
\begin{list}{}{%
\setlength{\topsep}{0pt}%
\setlength{\leftmargin}{#1}%
\setlength{\rightmargin}{#2}%
\setlength{\listparindent}{\parindent}%
\setlength{\itemindent}{\parindent}%
\setlength{\parsep}{\parskip}%
}%
\item[]}{\end{list}}

% The title page
% #1: main title of the presentation
% #2: subtitle
% #3: authors sperated by commas
% #4: institutes separated by commas
% #5: date, leave empty if you want today's date
% #6: language, {en|fr} stands for english and french
\newcommand\mytitlepage[6]{
\def\@en{en}
\def\@fr{fr}
\ifthenelse{\equal{\@mypagenumbering}{full}}
{}
{\addtocounter{framenumber}{-1}}
\vskip4.em
\vbox{
\vbox{\begin{changemargin}{\@titleleftmargin}{+0cm}\hskip-0.5ex{\LARGE\color{anssibleu}#1}\end{changemargin}}
\ifthenelse{\equal{#2}{}}
{}
{\vbox{\begin{changemargin}{\@titleleftmargin}{+0cm}\hskip0ex{\small\color{anssibleu}#2}\end{changemargin}}}
\vskip0.5em
\vbox{\begin{changemargin}{\@titleleftmargin}{+0cm}\hskip0ex{\footnotesize#3}\end{changemargin}}
\vbox{\begin{changemargin}{\@titleleftmargin}{+0cm}\hskip0ex{\scriptsize\color{gris}{#4}}\end{changemargin}}
\def\@new{#5}
\ifthenelse{\equal{#5}{}}
{\vbox{\begin{changemargin}{\@titleleftmargin}{+0cm}\hskip0ex{\scriptsize\color{gris}\today}\end{changemargin}}\global\let\@mydate\today}
{\vbox{\begin{changemargin}{\@titleleftmargin}{+0cm}\hskip0ex{\scriptsize\color{gris}{#5}}\end{changemargin}}\global\let\@mydate\@new}
}
\ifthenelse{\equal{#6}{fr}}
{\global\let\@mylang\@fr}
{\global\let\@mylang\@en}
}

% Activate page numbering on page bottom? {yes|no|full}
% #1 yes: count pages without breaks, firts page and outline page
%    full: count full pages 
%    no: no count at all
\newcommand\usepagenumbering[1]{
\ifthenelse{\equal{\@globalbackgroundimage}{full}}{}
{\setbeamertemplate{background canvas}[default]}
\def\@yes{yes}
\def\@no{no}
\def\@full{full}
\ifthenelse{\equal{#1}{yes}}
{\global\let\@mypagenumbering\@yes}
{\ifthenelse{\equal{#1}{full}}
{\global\let\@mypagenumbering\@full}
{\global\let\@mypagenumbering\@no}}
}

% Show background image on title page? {yes|full}
\newcommand\usebackgroundimage[2]{
\def\@full{full}
\ifthenelse{\equal{#1}{}}
{}%
{
\pgfdeclareimage[height=10cm,width=13cm]{bgimg}{#1}
\setbeamertemplate{background canvas}{
  \begin{colormixin}{50!averagebackgroundcolor}
    	\pgfuseimage{bgimg}%
  \end{colormixin}
}
}
\ifthenelse{\equal{#2}{full}}{\global\let\@globalbackgroundimage\@full}{}
}

% Activate and set the confidentiality level: 
%   #1: DL="diffusion libre"|DR="diffusion restreinte"|CD="confidentiel défense"|SD="secret défense"
%   #2: Coutry diffusion list when necessary
%   #3: yes/no --> do we want to apply the label on each frame?
\newcommand\useconfidentiality[3]{
\def\@first{DL}
\def\@second{DR}
\def\@third{CD}
\def\@fourth{SD}
\def\@new{#1}
\def\@ok{0}
\def\@one{1}
\def\@none{none}
\ifx \@new \@first
\global\let\@myconfidentiality\@new
\let\@ok\@one
\fi
\ifx \@new \@second
\global\let\@myconfidentiality\@new
\let\@ok\@one
\fi
\ifx \@new \@third
\global\let\@myconfidentiality\@new
\let\@ok\@one
\fi
\ifx \@new \@fourth
\global\let\@myconfidentiality\@new
\let\@ok\@one
\fi
\ifx \@ok \@one
\else
\global\let\@myconfidentiality\@none
\fi
\ifthenelse{\equal{#2}{}}{}{\def\@mydiffcountries{#2}}
\ifthenelse{\equal{#3}{yes}}{\def\@globalconfidentiality{yes}}{\def\@globalconfidentiality{no}}
}

% Handle confidentiality levels and country diffusion list
\newcommand\confidentialityheader[1]{
  \ifthenelse{\equal{\@myconfidentiality}{none}}
  {}
  {
  \def\@en{en}
  \def\@fr{fr}
  \def\@first{DL}
  \def\@second{DR}
  \def\@third{CD}
  \def\@fourth{SD}
  \vskip.7ex\hskip10em
  \ifx \@myconfidentiality \@first
    \ifx \@mylang \@fr
    \color{anssibleu}\Ovalbox{\ttfamily\tiny\color{anssibleu}{#1Diffusion Libre}}
    \else
    \color{anssibleu}\Ovalbox{\ttfamily\tiny\color{anssibleu}{#1No Restriction}}
    \fi
  \fi
  \ifx \@myconfidentiality \@second
    \ifx \@mylang \@fr
    \color{rougel}\Ovalbox{\ttfamily\tiny\color{rougel}{#1Diffusion Restreinte}}
    \else
    \color{rougel}\Ovalbox{\ttfamily\tiny\color{rougel}{#1Restricted Diffusion}}
    \fi
  \fi
  \ifx \@myconfidentiality \@third
    \ifx \@mylang \@fr
    \color{rougel}\Ovalbox{\ttfamily\tiny\color{rougel}{#1Confidentiel D\'{e}fense}}
    \else
    \color{rougel}\Ovalbox{\ttfamily\tiny\color{rougel}{#1Defence Classified}}
    \fi
  \fi
  \ifx \@myconfidentiality \@fourth
    \ifx \@mylang \@fr
    \color{rouge}\Ovalbox{\ttfamily\tiny\color{rouge}{#1Secret D\'{e}fense}}
    \else
    \color{rouge}\Ovalbox{\ttfamily\tiny\color{rouge}{#1Defence Secret}}
    \fi
  \fi
  \ifx \@mylang \@fr
    \ifthenelse{\equal{\@mydiffcountries}{}}{}{\color{anssibleu}\Ovalbox{\ttfamily\tiny\color{anssibleu}{#1Sp\'{e}cial~\@mydiffcountries}}}
  \else
    \ifthenelse{\equal{\@mydiffcountries}{}}{}{\color{anssibleu}\Ovalbox{\ttfamily\tiny\color{anssibleu}{#1For~\@mydiffcountries}}}
  \fi  
 }
}

\defbeamertemplate{headline}{title slide}{%
  \setlength\fboxsep{3pt}
  \confidentialityheader{}
}

\defbeamertemplate{footline}{title slide}{%
  \leavevmode
  \parbox{\textwidth}{
    \hfill
    \includegraphics[height=35ex]{logos/logo-v8-medaille.pdf}
    \hfill\rule{0pt}{0pt}
  %\hskip20ex
  %\ifthenelse{\equal{\@mylang}{fr}}
  %{\bf\ttfamily\tiny\color{anssibleu}Assistance, Conseil et Expertise}
  %{\bf\ttfamily\tiny\color{anssibleu}Assistance, Conseil et Expertise}
  %\hskip15ex
  %\includegraphics[height=9ex]{logos/anssi_logo2.png}
  }
  \vskip10ex
}

% Table of content
\newcommand\mytableofcontents{
  \ifthenelse{\equal{\@mypagenumbering}{full}}
  {}
  {\addtocounter{framenumber}{-1}}
  \frame[shrink]{\vbox{\begin{textblock*}{\paperwidth}(1cm,1.5cm)\tableofcontents\end{textblock*}}}
}

% Activate the upper navigation bar? {yes|no}{style=0, 1 or 2}
% #1 yes/no
% #2 (the style) changes the navigation style bar. Play with it!
\newcommand\usenavigation[3]{
\def\@zero{0}
\def\@one{1}
\def\@two{2}
\def\@three{3}
\def\@four{4}
\def\@five{5}
\def\@six{6}
\def\@seven{7}
\def\@eight{8}
\ifthenelse{\equal{#3}{0}}{\global\let\@mysubnavigation\@zero}{}
\ifthenelse{\equal{#3}{1}}{\global\let\@mysubnavigation\@one}{}
\ifthenelse{\equal{#3}{2}}{\global\let\@mysubnavigation\@two}{}
\ifthenelse{\equal{#3}{3}}{\global\let\@mysubnavigation\@three}{}
\ifthenelse{\equal{#3}{4}}{\global\let\@mysubnavigation\@four}{}
\ifthenelse{\equal{#3}{5}}{\global\let\@mysubnavigation\@five}{}
\ifthenelse{\equal{#3}{6}}{\global\let\@mysubnavigation\@six}{}
\ifthenelse{\equal{#1}{yes}}
{\global\let\@mynavigation\@one}
{\global\let\@mynavigation\@zero\global\let\@mysubnavigation\@zero}
\ifthenelse{\equal{#2}{0}}
{\definecolor{inversevideodessous}{rgb}{0,0.26,0.58}
\definecolor{inversevideodessus}{rgb}{1,1,1}
\usesectionheadtemplate{\zsavepos{\thesection}\colorbox{inversevideodessous}{\color{inversevideodessus} \insertsectionhead{\color{inversevideodessous}|}}}{\color{inversevideodessous}\insertsectionhead|}}
{\ifthenelse{\equal{#2}{2}}
{\definecolor{inversevideodessous}{rgb}{1,1,1}
\definecolor{inversevideodessus}{rgb}{0,0.26,0.58}
\usesectionheadtemplate{\zsavepos{\thesection}\colorbox{inversevideodessous}{\color{inversevideodessus} \insertsectionhead}}{\color{inversevideodessous}\insertsectionhead}}
}
{}
\ifthenelse{\equal{#2}{0}}
{\global\let\@mynavigationtype\@zero}
{}
\ifthenelse{\equal{#2}{1}}
{\global\let\@mynavigationtype\@one}
{}
\ifthenelse{\equal{#2}{2}}
{\global\let\@mynavigationtype\@two}
{}
\ifthenelse{\equal{#2}{3}}
{\global\let\@mynavigationtype\@three}
{}
\ifthenelse{\equal{#2}{4}}
{\global\let\@mynavigationtype\@four}
{}
\ifthenelse{\equal{#2}{5}}
{\global\let\@mynavigationtype\@five}
{}
\ifthenelse{\equal{#2}{6}}
{\global\let\@mynavigationtype\@six\global\let\@mysubnavigation\@zero}
{}
\ifthenelse{\equal{#2}{7}}
{\global\let\@mynavigationtype\@seven
\ifthenelse{\equal{#3}{5}}{\global\let\@mysubnavigation\@zero}{}
\ifthenelse{\equal{#3}{6}}{\global\let\@mysubnavigation\@zero}{}
}
{}
\ifthenelse{\equal{#2}{8}}
{\global\let\@mynavigationtype\@eight
\ifthenelse{\equal{#3}{5}}{\global\let\@mysubnavigation\@zero}{}
\ifthenelse{\equal{#3}{6}}{\global\let\@mysubnavigation\@zero}{}
}
{}
\ifthenelse{\equal{#2}{1}}{\definecolor{inversevideodessous}{rgb}{0.8,0.8,0.8}
\definecolor{inversevideodessus}{rgb}{0,0.26,0.58}
\usesectionheadtemplate{\zsavepos{\thesection}\color{inversevideodessous}{\color{inversevideodessus} \insertsectionhead|}}{\color{inversevideodessous} \insertsectionhead|}}{}

\ifthenelse{\equal{#2}{3}}{
\ifthenelse{\equal{#3}{3}}{
\usesubsectionheadtemplate{\setlength\fboxsep{1.5pt}\hfill\fcolorbox{anssibleu}{grisl2}{\color{rougel}\insertsubsectionhead{\color{grisl2}}}}{\color{grisl3}\hfill\insertsubsectionhead}}{}
\ifthenelse{\equal{#3}{4}}{
\definecolor{inversevideodessous2}{rgb}{0.8,0.8,0.8}
\usesubsectionheadtemplate{\color{inversevideodessous2}{\color{rougel}\hfill\insertsubsectionhead}}{\color{inversevideodessous2}\hfill\insertsubsectionhead}}{}
}
%
{\ifthenelse{\equal{#3}{3}}{
\usesubsectionheadtemplate{\fcolorbox{anssibleu}{grisl2}{\color{rougel} \insertsubsectionhead{\color{grisl2}|}}}{\color{grisl3}\insertsubsectionhead|}}{}
\ifthenelse{\equal{#3}{4}}{
\definecolor{inversevideodessous2}{rgb}{0.8,0.8,0.8}
\usesubsectionheadtemplate{\color{inversevideodessous2}{\color{rougel} \insertsubsectionhead|}}{\color{inversevideodessous2} \insertsubsectionhead|}}{}
\ifthenelse{\equal{#3}{5}}{
\usesubsectionheadtemplate{\fcolorbox{anssibleu}{grisl2}{\color{rougel} \insertsubsectionhead{\color{grisl2}|}}}{\color{grisl3}\insertsubsectionhead|}}{}
\ifthenelse{\equal{#3}{6}}{
\definecolor{inversevideodessous2}{rgb}{0.8,0.8,0.8}
\usesubsectionheadtemplate{\color{inversevideodessous2}{\color{rougel} \insertsubsectionhead|}}{\color{inversevideodessous2} \insertsubsectionhead|}}{}
\ifthenelse{\equal{#2}{4}}{
\usesectionheadtemplate{\zsavepos{\thesection}\setlength\fboxsep{2pt}\fcolorbox{anssibleu}{grisl2}{\color{rougel}\insertsectionhead{\color{grisl2}}}}{\color{grisl3}\insertsectionhead}}{}
\ifthenelse{\equal{#2}{5}}{
\usesectionheadtemplate{\zsavepos{\thesection}\setlength\fboxsep{3pt}\fcolorbox{rougel}{anssibleu}{\color{white}\insertsectionhead{\color{grisl2}}}}{\setlength\fboxsep{1.5pt}\fcolorbox{grisl3}{grisl}{\color{rougel}\insertsectionhead}}}{}
\ifthenelse{\equal{#2}{6}}{
\usesectionheadtemplate{\setlength\fboxsep{2.5pt}\hfill\fcolorbox{rougel}{anssibleu}{\color{white}\insertsectionhead{\color{grisl2}}}}{\setlength\fboxsep{1pt}\hfill\fcolorbox{grisl3}{grisl2}{\color{anssibleu}\insertsectionhead}}}{}
\ifthenelse{\equal{#2}{7}}{
\usesectionheadtemplate{}{}}{}
\ifthenelse{\equal{#2}{8}}{
\usesectionheadtemplate{}{}}{}
}
}

\def\supertiny{\font\supertinyfont = ec-lmr10 at 5pt \relax \supertinyfont}
\defbeamertemplate{headline}{body}{%
\ifthenelse{\equal{\@mynavigation}{1}}
{
  \ifthenelse{\equal{\@mynavigationtype}{3}}
  {
  \ifthenelse{\equal{\@globalconfidentiality}{yes}}
  {
  \vbox{\begin{textblock*}{\paperwidth}(0cm,0cm)\setlength\fboxsep{1pt}\confidentialityheader{\supertiny}\end{textblock*}}
  }{}
  \begin{beamercolorbox}[wd=0.5\paperwidth, right]{section in head/foot} 
  \end{beamercolorbox}
  \begin{beamercolorbox}[wd=\textwidth, right]{section in head/foot}
  \colorbox{anssibleu}{\ttfamily\tiny\color{white}\hfill\insertsectionhead}
  \end{beamercolorbox}
  }
  {
   \ifthenelse{\equal{\@mynavigationtype}{6}}
   {
    \ifthenelse{\equal{\@globalconfidentiality}{yes}}
    {
      \vbox{\begin{textblock*}{\paperwidth}(0cm,0cm)\setlength\fboxsep{1pt}\confidentialityheader{\supertiny}\end{textblock*}}
    }{}
   }
   {%\textblockorigin{8cm}{0cm}
   \ifthenelse{\equal{\@globalconfidentiality}{yes}}{
   \begin{textblock*}{10cm}(8cm-\widthof{\supertiny Sp\'{e}cial~\@mydiffcountries},-1px)
   {{\setlength\fboxsep{1pt}\confidentialityheader{\supertiny}}}
   \end{textblock*}}{}
   \begin{beamercolorbox}[wd=\paperwidth]{section in head/foot}
  \setbeamercolor{section in head/foot}{fg=anssibleu}
  {\ttfamily\tiny\insertsectionnavigationhorizontal{0pt}{}{}}
   \end{beamercolorbox}\ifthenelse{\equal{\@mysubnavigation}{2}}{\vskip.2em}{}
   \ifthenelse{\equal{\@mysubnavigation}{3}}{\vskip.6em}{}
   \ifthenelse{\equal{\@mysubnavigation}{4}}{\vskip.6em}{}
   \ifthenelse{\equal{\@mysubnavigation}{5}}{\vskip.6em}{}
   \ifthenelse{\equal{\@mysubnavigation}{6}}{\vskip.6em}{}
   }}
    \ifthenelse{\equal{\@mynavigationtype}{6}}{
      \hskip 9px
      \begin{beamercolorbox}[wd=\paperwidth, ht=\@tempdimb]{section in head/foot}
      \vbox to \@tempdimb{\vfil{\ttfamily\tiny\insertsectionnavigation{\paperwidth}\vfil}}
      \end{beamercolorbox}
    }
    {\ifthenelse{\equal{\@mynavigationtype}{3}}
    {
    \ifthenelse{\equal{\@mysubnavigation}{1}}{
    \begin{beamercolorbox}[wd=\textwidth, right]{section in head/foot}
    \ifx\insertsubsectionhead\empty\else
      \fcolorbox{anssibleu}{grisl2}{\ttfamily\tiny\color{rougel}\ttfamily\tiny\insertsubsectionhead}
    \fi
    \end{beamercolorbox}}{}
    \ifthenelse{\equal{\@mysubnavigation}{2}}{
    \vskip.5ex
    \hskip-0.3em{\begin{beamercolorbox}[wd=\textwidth, right]{section in head/foot}
    \ifx\insertsubsectionhead\empty\else
      {\ttfamily\tiny\color{rougel}\ttfamily\tiny\insertsubsectionhead}
    \fi\end{beamercolorbox}}}{}
    \ifthenelse{\equal{\@mysubnavigation}{3}}{
      \hskip 7px
      \begin{beamercolorbox}[wd=\paperwidth, ht=\@tempdimb]{section in head/foot}
      \vbox to \@tempdimb{\vfil{\ttfamily\tiny\insertsubsectionnavigation{\paperwidth}\vfil}}
      \end{beamercolorbox}
    }{}
    \ifthenelse{\equal{\@mysubnavigation}{4}}{
      \hskip 5px
      \begin{beamercolorbox}[wd=\paperwidth, ht=\@tempdimb]{section in head/foot}
      \vbox to \@tempdimb{\vfil{\ttfamily\tiny\insertsubsectionnavigation{\paperwidth}\vfil}}
      \end{beamercolorbox}
    }{}
    }
    {
    \ifthenelse{\equal{\@mynavigationtype}{7}}{
      \ifthenelse{\equal{\@mysubnavigation}{3}}{\vskip-4px}{}
      \ifthenelse{\equal{\@mysubnavigation}{4}}{\vskip-4px}{}
      {\vskip-4px{\hskip12px\setlength\fboxsep{2.5pt}\colorbox{anssibleu}{\color{white}{\ttfamily\tiny\insertsectionhead}}}}
    }{}
    \ifthenelse{\equal{\@mynavigationtype}{8}}{
      \ifthenelse{\equal{\@mysubnavigation}{3}}{\vskip-4px}{}
      \ifthenelse{\equal{\@mysubnavigation}{4}}{\vskip-4px}{}
      {\vskip-4px{\hskip12px\setlength\fboxsep{2.5pt}\fcolorbox{rougel}{anssibleu}{\color{white}{\ttfamily\tiny\insertsectionhead}}}}
    }{}
    \ifthenelse{\equal{\@mysubnavigation}{1}}{
    \ifthenelse{\equal{\@mynavigationtype}{7}}{      
    }{\ifthenelse{\equal{\@mynavigationtype}{8}}{}{\vskip.55ex}}
    \ifthenelse{\equal{\@mynavigationtype}{2}}{\hskip3px}{}
    \begin{beamercolorbox}[wd=\paperwidth]{section in head/foot}
    \setlength\fboxsep{1pt}
    \ifx\insertsubsectionhead\empty\else
      \hskip\zposx{\thesection}sp\fcolorbox{anssibleu}{grisl2}{\ttfamily\tiny\color{rougel}\ttfamily\tiny\insertsubsectionhead}
    \fi
    \end{beamercolorbox}}{}
    \ifthenelse{\equal{\@mysubnavigation}{2}}{
    \ifthenelse{\equal{\@mynavigationtype}{7}}{\hskip-10px
    }{\ifthenelse{\equal{\@mynavigationtype}{8}}{\hskip-10px}{\vskip.8ex}}
    \ifthenelse{\equal{\@mynavigationtype}{2}}{\hskip3px}{}
    \ifx\insertsubsectionhead\empty\else
      \hskip\zposx{\thesection}sp{\ttfamily\tiny\color{rougel}\ttfamily\tiny\insertsubsectionhead}
    \fi}{}
    \ifthenelse{\equal{\@mysubnavigation}{3}}{
    \ifthenelse{\equal{\@mynavigationtype}{2}}{\hskip3px}{}
    \begin{beamercolorbox}[wd=\paperwidth]{section in head/foot}
    \ifthenelse{\equal{\@mynavigationtype}{7}}{\hskip-15px
    }{\ifthenelse{\equal{\@mynavigationtype}{8}}{\hskip-15px}{\hskip-1.5em}}
    \setlength\fboxsep{1pt}
    \ifx\insertsubsectionhead\empty\else
      \hskip\zposx{\thesection}sp{\ttfamily\tiny\insertsubsectionnavigationhorizontal{0pt}{}{}}
    \fi
    \end{beamercolorbox}}{}
    \ifthenelse{\equal{\@mysubnavigation}{4}}{
    \ifthenelse{\equal{\@mynavigationtype}{2}}{\hskip3px}{}
    \begin{beamercolorbox}[wd=\paperwidth]{section in head/foot}
    \ifthenelse{\equal{\@mynavigationtype}{7}}{\hskip-15px
    }{\ifthenelse{\equal{\@mynavigationtype}{8}}{\hskip-15px}{\ifthenelse{\equal{\@mynavigationtype}{0}}{}{\vskip-0.4em}\hskip-1.5em}}
    \ifx\insertsubsectionhead\empty\else
      \hskip\zposx{\thesection}sp{\ttfamily\tiny\insertsubsectionnavigationhorizontal{0pt}{}{}}
    \fi
    \end{beamercolorbox}}{}
    \ifthenelse{\equal{\@mysubnavigation}{5}}{
    \ifthenelse{\equal{\@mynavigationtype}{2}}{\hskip3px}{}
    \begin{beamercolorbox}[wd=\paperwidth]{section in head/foot}
    \hskip-1.5em
    \setlength\fboxsep{1pt}
    \ifx\insertsubsectionhead\empty\else
      \hskip1.5em{\ttfamily\tiny\insertsubsectionnavigationhorizontal{0pt}{}{}}
    \fi
    \end{beamercolorbox}}{}
    \ifthenelse{\equal{\@mysubnavigation}{6}}{
    \ifthenelse{\equal{\@mynavigationtype}{0}}{}{\vskip-0.4em}
    \ifthenelse{\equal{\@mynavigationtype}{2}}{\hskip3px}{}
    \begin{beamercolorbox}[wd=\paperwidth]{section in head/foot}
    \hskip-1.2em
    \ifx\insertsubsectionhead\empty\else
      \hskip1.5em{\ttfamily\tiny\insertsubsectionnavigationhorizontal{0pt}{}{}}
    \fi
    \end{beamercolorbox}}{}
    }}
  }
  {
   \ifthenelse{\equal{\@globalconfidentiality}{yes}}{
   \begin{textblock*}{10cm}(8cm-\widthof{\supertiny Sp\'{e}cial~\@mydiffcountries},-1px)
   {{\setlength\fboxsep{1pt}\confidentialityheader{\supertiny}}}
   \end{textblock*}}{}
  }
}


% Breaks
% \dobreak{#1}{#2}{#3}{#4}{#5}{#6}{#7}{#8}
% #1: {vertical|horizontal|plain} for vertical or horizontal breaks, or a full screen image
% #2: {right|left|up|down} is the place where to put the image. right and left are compatible with vertical breaks only, up and down with 
%     horizontal breaks only.
% #3: the image you want to insert. It will be stretched to fit half of the screen (or the full screen).
% #4: The text you want to insert. You can also add inside it any beamer macro (\only, ...)
% #5: background color to be used. Black is default.
% #6: Font color to be used, anssibleu is default.
% #7: effect to be used for your slide (transsplitverticalout, transdissolve ...)
% #8: Position of the text in (x,y) coordinates. Only active for the "plain" (fullscreen) mode.
\newcommand\dobreak[8]{
 {      
   \ifthenelse{\equal{\@mypagenumbering}{full}}
   {}
   {\addtocounter{framenumber}{-1}}
   \def\@color{anssibleu}
   \def\@mycolor{#6}
   \ifthenelse{\equal{#5}{}}
   {\beamersetaveragebackground{black} 
    \setbeamertemplate{headline}{\phantom{\color{black}A}}}   
   {\beamersetaveragebackground{#5}
    \setbeamertemplate{headline}{\phantom{\color{black}A}}}
   \ifthenelse{\equal{#6}{}}
   {}   
   {\let\@color\@mycolor}
   {\beamersetaveragebackground{#6}}
   \setbeamertemplate{footline}{}
   % Vertical
   \ifthenelse{\equal{#1}{vertical}}
   { 
     \ifthenelse{\equal{#2}{right}}
     {\begin{frame}[plain]{}\begin{changemargin}{0.6cm}{+0cm}%
      \ifthenelse{\equal{#7}{}}
      {}   
      {\expandafter\csname #7\endcsname}
      \begin{tabular}{p{0.5\paperwidth}p{0.5\paperwidth}}
      \multirow{1}{\paperheight}{\color{\@color}#4} & \multirow{1}{\paperheight}{\rput[lt](-1.64,3.9){\includegraphics[clip=true,width=0.50\paperwidth, height=\paperheight]{#3}}}
      \end{tabular}\end{changemargin}
     \end{frame}}
     {\begin{frame}[plain]{}\begin{changemargin}{0.6cm}{+0cm}
      \ifthenelse{\equal{#7}{}}
      {}   
      {\expandafter\csname #7\endcsname}
      \begin{tabular}{p{0.5\paperwidth}p{0.5\paperwidth}}
      \multirow{1}{\paperheight}{\rput[lt](-1.25,3.89){\includegraphics[clip=true,width=0.50\paperwidth, height=\paperheight]{#3}}} &  \multirow{1}{\paperheight}{\color{\@color}#4}
      \end{tabular}\end{changemargin}
      \end{frame}}
   }
   % Horizontal
   {
   \ifthenelse{\equal{#1}{horizontal}}
    {\begin{frame}[plain]\begin{changemargin}{0.6cm}{+0cm}
     \ifthenelse{\equal{#7}{}}
    {}   
    {\expandafter\csname #7\endcsname}
    \ifthenelse{\equal{#2}{up}}   
    {\vskip9em
    {\begin{tabular}{p{\paperwidth}}
      \multirow{1}{0.5\paperheight}{\rput[lt](-1.22,5.77){\includegraphics[clip=true,width=\paperwidth, height=0.50\paperheight]{#3}}}\\
      \multirow{1}{0.5\paperheight}{\color{\@color}#4}
    \end{tabular}}
    }
    {
    {\vskip-9em\begin{tabular}{p{\paperwidth}}
      \multirow{1}{0.5\paperheight}{\color{\@color}#4}\\
      \multirow{1}{0.5\paperheight}{\rput[lt](-1.22,-2.4){\includegraphics[clip=true,width=\paperwidth, height=0.50\paperheight]{#3}}}
    \end{tabular}}
    }
    \end{changemargin}
    \end{frame}
   }   
   % Plain
   {\begin{frame}[plain]\begin{changemargin}{0.6cm}{+0cm}
    \ifthenelse{\equal{#7}{}}
    {}   
    {\expandafter\csname #7\endcsname}
    \begin{tabular}{p{\paperwidth}}
      \ifthenelse{\equal{#3}{}}     
      {}
      {\multirow{1}{\paperheight}{\rput[lt](-1.2,3.95){\includegraphics[clip=true,width=\paperwidth, height=\paperheight]{#3}}}}
    \end{tabular}
    \ifthenelse{\equal{#8}{}}
    {\rput(1,1){\vbox{{\color{\@color}#4}}}}
    {\rput#8{\vbox{{\color{\@color}#4}}}}
    \end{changemargin}\end{frame}}
   }
 }
}

\defbeamertemplate{footline}{body}%
{
\leavevmode%
\hskip3ex\hbox{%
\begin{beamercolorbox}[wd=.05\paperwidth,ht=2.25ex]{author in head/foot}
\ifthenelse{\equal{\value{framenumber}}{0}}
{}
{\ifthenelse{\equal{\@mypagenumbering}{no}}{}{\ttfamily\Tiny\color{anssibleu}~\insertframenumber/\inserttotalframenumber}{}}
\end{beamercolorbox}%
\begin{beamercolorbox}[wd=.7\paperwidth,ht=2.25ex,center]{author in head/foot}
{\ttfamily\tiny\color{gris}~\inserttitle~-~\@mydate}
\end{beamercolorbox}%
\begin{beamercolorbox}[wd=.2\paperwidth,ht=2.25ex,dp=1ex,right]{author in head/foot}
{\includegraphics[height=8.5ex]{logos/logo-v8-sigle-nocomet.pdf}}
\end{beamercolorbox}
}%
\vskip1ex
}

% Symboles de navigation
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{frametitle}{\vspace{.6cm}\insertframetitle\vskip-1.5em}

\setbeamertemplate{itemize item}[square] 
\setbeamertemplate{itemize subitem}[circle] 
\setbeamertemplate{itemize subsubitem}[default] 

\setbeamercolor{section in toc}{fg=anssibleu,bg=white}
\setbeamercolor{subsection in toc}{fg=gris,bg=white}
\setbeamertemplate{section in toc}[square]

\newcounter{toccounter}
\setbeamertemplate{subsection in toc}{
\leavevmode\leftskip=1.5em
\edef\Temp{\noexpand\setcounter{toccounter}{\inserttocsubsectionnumber}}\Temp
{\footnotesize\alph{toccounter}.~\inserttocsubsection\par}}

\setbeamercolor{alerted text}{fg=anssibleu!80!gray}

\setbeamercolor*{sidebar}{fg=anssibleu,bg=gray!15!white}

\setbeamercolor*{palette sidebar primary}{fg=anssibleu!10!black}
\setbeamercolor*{palette sidebar secondary}{fg=white}
\setbeamercolor*{palette sidebar tertiary}{fg=anssibleu!50!black}
\setbeamercolor*{palette sidebar quaternary}{fg=gray!10!white}

\setbeamercolor*{titlelike}{parent=palette primary}
\setbeamercolor{titlelike}{parent=palette primary,fg=anssibleu}

\setbeamercolor*{separation line}{}
\setbeamercolor*{fine separation line}{}

\setbeamercolor{item}{fg=anssibleu}
\setbeamercolor{block}{title=anssibleu}
\setbeamercolor{block title}{fg=anssibleu}
\setbeamercolor{structure}{fg=anssibleu}
\setbeamertemplate{footline}[title slide]
\setbeamertemplate{headline}[title slide]

% Boxes
\setbeamercolor{uppercol}{fg=white, bg=anssibleu}%
\setbeamercolor{lowercol}{fg=black,bg=grisl}%

% Body text left margin 
\setbeamersize{text margin left = \@bodyleftmargin}

\def\th@something{%
  \normalfont % body font
  \def\inserttheoremblockenv{alertblock}  
}
\theoremstyle{theorem}
\newtheorem{warn}[theorem]{WARNING}
\makeatother

\mode
<all>
